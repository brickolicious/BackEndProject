<!DOCTYPE html>
<html>
  <head>
    <title>AlertMap</title>
    <link href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css' rel="stylesheet" type="text/css"/>

    <link rel='stylesheet' href='/stylesheets/style.css' />



  </head>
  <body>



  <div class="container-fluid">



    <article class="row">

      <nav class="navbar navbar-default" role="navigation">
        <a href="/" class="homeNav" title="home"><span class="glyphicon glyphicon-home"></span>ALERT MAP</a>

        <section id="register" class="toHideOrNotToHide">

          <form action="/register" method="POST">
          <label for="username"><span class="glyphicon glyphicon-user"></span></label><input type="text" required="required" name="username" id="username" placeholder="username" pattern="{5,15}" title="5-15 characters"/>
          <label for="password"><span class="glyphicon glyphicon-lock"></span></label><input type="text" required="required" name="password" id="password" placeholder="password" pattern="{5,15}" title="5-15 characters"/>
          <label for="email"><span class="glyphicon glyphicon-envelope"></span></label><input type="email" name="email" id="email"/>
          <input type="submit" id="regBtn" value="register"/>
          <button  id="showRegLogin">Login</button>
          </form>
        </section>

        <section id="forgot" class="toHideOrNotToHide">

          <form action="/forgot" method="POST">
            <label for="email"><span class="glyphicon glyphicon-envelope"></span></label><input type="email" name="email" require="require" placeholder="email" id="email"/>
            <input type="submit" id="forgotBtn" value="request password"/>
            <button  id="showLogin">Login</button>
          </form>
        </section>

        <section id="login">

          <% if(user==null){ %>
          <form id="loginForm" action="/login" method="post">

          <label for="username"><span class="glyphicon glyphicon-user"></span></label><input type="text" required="required" name="username" id="username" placeholder="username"/>
          <label for="password"><span class="glyphicon glyphicon-lock"></span></label><input type="password" required="required" name="password" id="password" placeholder="password"/>
          <input type="submit" value="login"/>
          <button  id="showReg">register</button>
          <button  id="showPass">forgot password</button>
          </form>
          <% }else{ %>

          <p>Hello, <%= user.username %>! </p>

          <% } %>


            <!--  <a href="/auth/facebook" id="fbLogin"><span class="glyphicon glyphicon-user"></span>Login</a>-->
        </section>
      </nav>


      <input id="pac-input" class="controls" type="text" placeholder="Enter a location"/>
      <div id="type-selector" class="controls">
        <input type="radio" name="type" id="changetype-all" checked="checked">
        <label for="changetype-all">All</label>

        <input type="radio" name="type" id="changetype-establishment">
        <label for="changetype-establishment">Establishments</label>

        <input type="radio" name="type" id="changetype-address">
        <label for="changetype-address">Addresses</label>

        <input type="radio" name="type" id="changetype-geocode">
        <label for="changetype-geocode">Geocodes</label>
      </div>

      <% if(user != null){ %>
      <section id="chat" class="col-md-2">
        <ul id="messages">
          <li>Welcome  <span id="userName"><%= user.username %></span></li>
        </ul>
        <form id="chatForm" action="">
          <input id="sendMessage" autocomplete="off" />
          <button id="sendChat">Send</button>
        </form>
      </section>
      <script></script>
      <% } %>


      <% if(user != null){ %>
      <section id="map-canvas" class="col-md-7">

        <!--Body content-->
      </section>
        <% }else{ %>

      <section id="map-canvas" class="col-md-9">

        <!--Body content-->
      </section>

          <% } %>




      <aside class="col-md-3">

        <section id="sideMenu">


          <section id="infoPanel">
            <h1>Alert</h1>
            <!--<h2>Marker status:</h2>
            <div id="markerStatus"><i>Click and drag the marker.</i></div>-->
            <h2>Marker position:</h2>
            <p id="info"></p>
            <h2>Closest address:</h2>
            <p id="address"></p>
          </section>
          <% if(user != null){ %>

          <ul>
            <li><button type="button" value="1" class="btn btn1">Pick pocket</button></li>
            <li><button type="button" value="2" class="btn btn2">Harassment</button></li>
            <li><button type="button" value="3" class="btn btn3">Robbery</button></li>
            <li><button type="button" value="4" class="btn btn4">Burglary</button></li>
            <li><button type="button" value="5" class="btn btn5">Murder</button></li>
          </ul>

          <ul>
            <li><button type="button" value="0" class="btn btn0">Suspicious activity</button></li>
          </ul>
          <ul>
            <li><button type="button" class="btn btn-info">About alertmap</button></li>
          </ul>
          <% } %>

        </section>

        <!--Sidebar content-->
      </aside>
    </article>
  </div>


  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlXzNPrFk8mP1hbfi7xE-hqeYKRMeCo2g" type="text/javascript"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js" type="application/javascript"></script>
  <script src="/javascripts/map.js" type="text/javascript"></script>
  <script src="/javascripts/data.js" type="text/javascript"></script>


  <script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js' type="application/javascript"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="/javascripts/interaction.js" type="text/javascript"></script>

  <script>

    //304 code cached and not rerun, chat gets posted and needs be blocked by dirty code
    var socket = io();
    $('#chatForm').on('submit',function(e){

      socket.emit('chat message', $('#userName').html()+": "+$('#sendMessage').val());
      $('#sendMessage').val('');


      e.preventDefault();
      return false;
    });

    socket.on('chat message', function(msg){
      $('#messages').append($('<li>').text(msg));
    });

  </script>
  </body>
</html>
